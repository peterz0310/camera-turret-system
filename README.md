# Camera Turret System

This project is a modular camera turret system consisting of a web-based UI, a camera streaming backend, and firmware for controlling turret hardware. The system is containerized using Docker Compose for easy development and deployment.

## Project Structure

- **docker-compose.yml**: Orchestrates the services for development using Docker Compose.
- **ui/**: Next.js web application for controlling and viewing the camera turret.
- **camera-stream/**: Python backend for camera streaming and image processing.
- **firmware/**: Embedded code for controlling the turret hardware (motors and camera), organized for PlatformIO.

### Details

#### `ui/`

- Built with Next.js.
- Provides a user interface to control the turret and view the camera feed.
- Hot-reloads in development via Docker Compose.

#### `camera-stream/`

- Python application (see `app.py`).
- Proxies the ESP32-CAM MJPEG stream and can overlay AI detections server-side.
- Exposes REST endpoints for AI enable/disable, model selection, and FPS tuning.
- Can serve a fallback animated static stream if the camera is unavailable.

#### `firmware/`

- Contains PlatformIO projects for both camera and motor control.
- Each subfolder (`cam/`, `motors/`) has its own source code and configuration for embedded development.

## Development

### Prerequisites

- [Docker](https://www.docker.com/) and [Docker Compose](https://docs.docker.com/compose/)
- PlatformIO (for firmware development, optional)

### Running the System

1. Clone the repository.
2. From the root directory, run:
   ```bash
   docker-compose up --build
   ```
3. Access the UI at [http://localhost:3000](http://localhost:3000).

### UI configuration (overrides via environment)

The UI now reads its connection targets from environment variables (with the current IPs as safe defaults):

- `NEXT_PUBLIC_WEBSOCKET_URL` (default: `ws://192.168.4.29/ws`) — ESP32 motor controller WebSocket.
- `NEXT_PUBLIC_CAMERA_STREAM_BASE_URL` (default: `http://192.168.4.57:8081`) — Flask camera/AI gateway; stream lives at `/stream`, API at `/api`.

Set these in your shell or a `.env.local` inside `ui/` when the addresses differ. The Docker Compose file now provides `NEXT_PUBLIC_CAMERA_STREAM_BASE_URL=http://localhost:8081` by default so the UI talks to the bundled `camera-stream` container on both Linux and macOS. Override either variable if your hardware lives at a different LAN address.

### Firmware

- Firmware is managed separately using PlatformIO.
- See `firmware/cam/` and `firmware/motors/` for details.

### Parts List

| Part                                         | Description                                                                                                   | Link                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| -------------------------------------------- | ------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 12V power supply                             | Main power source for motors, drivers, and auxiliary electronics; choose a wattage with comfortable headroom. | [Amazon](https://www.amazon.com/dp/B082PCR5YS?ref_=ppx_hzsearch_conn_dt_b_fed_asin_title_7&th=1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| MP1584EN mini 5V buck converter (5pcs)       | Steps 12V down to stable 5V for logic, sensors, and camera.                                                   | [Amazon](https://www.amazon.com/dp/B0B779ZYN1?ref_=ppx_hzsearch_conn_dt_b_fed_asin_title_6&th=1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Rocker switch                                | Inline master power switch to quickly cut power for service and safety.                                       | [Amazon](https://www.amazon.com/dp/B0CVTRKJTV?ref=ppx_yo2ov_dt_b_fed_asin_title&th=1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Screw terminals                              | Clean power and signal distribution inside the enclosure without soldering every connection.                  | [Amazon](https://www.amazon.com/dp/B0D7VRSH1G?ref=ppx_yo2ov_dt_b_fed_asin_title&th=1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 2.54mm JST-XH connector kit (2/3/4/5/6 pin)  | Standardized, keyed wiring connectors for motors, sensors, and serviceable harnesses.                         | [Amazon](https://www.amazon.com/dp/B0FDK5RCBH?ref=ppx_yo2ov_dt_b_fed_asin_title&th=1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Various Dupont jumper cables                 | Leads for signal and power.                                                                                   | [Amazon](https://www.amazon.com/dp/B01EV70C78?ref=nb_sb_ss_w_as-reorder_k0_1_6&crid=1AK8URVEZEDLV&sprefix=dupont)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ESP32                                        | Main microcontroller for motor control, networking, and system logic.                                         | [Amazon](https://www.amazon.com/dp/B0C7C2HQ7P?ref=ppx_yo2ov_dt_b_fed_asin_title&th=1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ESP32 Cam                                    | Dedicated camera module for video capture and streaming.                                                      | [Amazon](https://www.amazon.com/dp/B0948ZFTQZ?ref=ppx_yo2ov_dt_b_fed_asin_title)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| DRV8825 stepper motor driver                 | Stepper driver for the NEMA 17 motors with adjustable current limiting.                                       | [Amazon](https://www.amazon.com/dp/B0C2CHTLCG?ref=ppx_yo2ov_dt_b_fed_asin_title)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| NEMA 17 motors 1.5A 42x42x38mm (x2)          | Pan/tilt drive motors that provide reliable torque for the turret axes.                                       | [Amazon](https://www.amazon.com/dp/B0B38GX54H?ref=ppx_yo2ov_dt_b_fed_asin_title)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| MG996R servo                                 | Compact servo for trigger mechanism.                                                                          | [Amazon](https://www.amazon.com/dp/B0BMM1G74B?ref=ppx_yo2ov_dt_b_fed_asin_title&th=1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Limit switches                               | End-stop switches for homing and preventing over-travel on tilt axis.                                         | [Amazon](https://www.amazon.com/dp/B07MW2RPJY?ref_=ppx_hzsearch_conn_dt_b_fed_asin_title_6)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Hall effect magnetic sensor module           | Non-contact position sensing for home detection and rotation reference.                                       | [Amazon](https://www.amazon.com/dp/B01NBE2XIR?ref=ppx_yo2ov_dt_b_fed_asin_title)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Neodymium magnets (small)                    | Magnet target for the hall effect sensor to detect a repeatable home position.                                | [Amazon](https://www.amazon.com/dp/B0CCXHY9P8?ref_=ppx_hzsearch_conn_dt_b_fed_asin_title_4&th=1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Slip ring                                    | Maintains power/data continuity while allowing continuous rotation of the turret.                             | [Amazon](https://www.amazon.com/dp/B07NW9PT4P?ref=ppx_yo2ov_dt_b_fed_asin_title)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Aluminium alloy turntable bearing (250mm)    | Large-diameter bearing that supports the rotating platform with low friction.                                 | [Amazon](https://www.amazon.com/dp/B08CSMR2B1?ref=ppx_yo2ov_dt_b_fed_asin_title&th=1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 608 bearings                                 | Standard skate-style bearings for tilt axis.                                                                  | [Amazon](https://www.amazon.com/dp/B0CYYYZRV9?ref_=ppx_hzsearch_conn_dt_b_fed_asin_title_1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 8mm flange coupling connectors               | Rigid couplers for the tilt drive shaft.                                                                      | [Amazon](https://www.amazon.com/dp/B0CSVZQHZY?ref=ppx_yo2ov_dt_b_fed_asin_title)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 8x100mm shafts                               | Main shaft that the marker tilts on.                                                                          | [Amazon](https://www.amazon.com/dp/B01NCOMFLT?ref=ppx_yo2ov_dt_b_fed_asin_title)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Assorted M3 screws                           | General fasteners for printed parts, brackets, and electronics mounting.                                      | [Amazon](https://www.amazon.com/dp/B0D3X5CT2J?ref=ppx_yo2ov_dt_b_fed_asin_title)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Zip ties (assorted sizes)                    | Cable management for clean routing and strain relief.                                                         | [Amazon](https://www.amazon.com/dp/B0C2Z4L3S6?ref=ppx_yo2ov_dt_b_fed_asin_title&th=1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Cooling fans (for electronics box)           | Active airflow to keep drivers and power components within safe temperatures.                                 | [Amazon](https://www.amazon.com/dp/B07P7DQ3VG?ref=ppx_yo2ov_dt_b_fed_asin_title)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Maddog Heavy Duty paintball tank remote coil | Remote air line to allow mounting the tank in a higher position while feeding the marker.                     | [Amazon](https://www.amazon.com/dp/B01D98NOVG?ref=ppx_yo2ov_dt_b_fed_asin_title&th=1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Tippmann Cronus                              | Primary marker used in the build; mounts to the turret for firing tests.                                      | [Amazon](https://www.amazon.com/Tippmann-Cronus-PowerPack-90gram-Raptor/dp/B01MYTMVRS/ref=sr_1_1?crid=CLVYOS3O11E7&dib=eyJ2IjoiMSJ9.PYHdmB_Lji9cYEDi3CWkX_qqPHxncHu-LLEYFT7YyrZ7cEB77cGFnt8v3EbTDzqHSRMppWYbWO8fsomjfKhlHFKsje9wQyH7F7SupxuDVsZmvnej91OmCZR27lvWn7I4pfHZf1pkzvikmVnrCJroLxuw1KKaPQVoP8E2KEfCHJ6zejy25dVcm3P7jwNMWsGSgZqN0T5PxBNjsT45WCJlvufAslcmtBaIdFKfI-hAcKSft3Msxm0sYbAMQl_tsKX0CxdvXUMGINlZpXcV-FsxclkI2bqb6Tf8aluOEe53wNg.kV5OhPtYEWjLZqZsuDKM0Dm3VnaImyl3Uh1-KMLn-C8&dib_tag=se&keywords=tippmann%2Bcronus&qid=1769709597&s=sporting-goods&sprefix=tippman%2Bcrunu%2Csporting%2C318&sr=1-1&th=1) |

### 3D printed parts

Many parts of this project are 3D printed. I used a BambuLabs A1 and PETG filament, but any printer with a sufficiently large build area (256mm^3) should be fine.

Files are available on MakerWorld.
